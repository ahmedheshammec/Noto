â†’ when saving response to HTML file using a-shell we need to modify the code a little bit cuz on the mac i was having response like this: 

```
b'<div class="result u-shadow--black" id="mainpicture">\r\n\t<div class="result_overlay pure-g">\r\n\t\t<div class="pure-u-1 pure-u-sm-1-2" id="avatarAndTextUsual">\r\n\t\t\t<div class="pure-u-6-24"><img class="result_author" src="https://tikcdn.io/ssstik/a/aHR0cHM6Ly9wMTYtcHUtdXNlYXN0OC50aWt0b2tjZG4tdXMuY29tL3Rvcy11c2Vhc3Q1LWF2dC0wMDY4LXR4LzczNDg5MDA5NDY2MzU2NTMxNjZ+dHBsdi10aWt0b2t4LWNyb3BjZW50ZXItcToxMDA6MTAwOnE3NS53ZWJwP2RyPTg4MzUmaWRjPXVzZWFzdDUmbm9uY2U9MzYyMTEmcHM9ODdkNmU0OGEmcmVmcmVzaF90b2tlbj04MWUxNTI3MTU5MzYwODljZDU4YWJkMGRjMzMwMTVmMSZzPUFXRU1FX0RFVEFJTCZzYz1hdmF0YXImc2hjcD0xZDFhOTdmYyZzaHA9NDUxMjYyMTcmdD0yMjM0NDljNA==" alt="Devin Jatho | Content Marketer"></div><div class="pure-u-18-24 pd-lr"><h2>Devin Jatho | Content Marketer</h2><p class="maintext">Stop Doing This \xf0\x9f\x9b\x91</p></div>\t\t</div>\r\n\r\n\t\t<div class="flex-1 result_overlay_buttons pure-u-1 pure-u-sm-1-2" id="dl_btns">\r\n\t\t\t<div id="dl1"></div>\r\n\t\t\t\r\n\t\t\t<a href="https://tikcdn.io/ssstik/7471660543137353006"\r\n\t\t\t\tclass="pure-button pure-button-primary is-center u-bl dl-button download_link without_watermark vignette_active notranslate">Without watermark</a>\r\n\r\n\t\t\t\t\t\t<a id="direct_dl_link" style="display:none" href="#" target="_blank"\r\n\t\t\t\tclass="pure-button pure-button-primary is-center u-bl dl-button buy_ios_app notranslate"></a>\r\n\t\t\t\r\n\t\t\t\t\t\t<a id="hd_download"\r\n\t\t\t\tonclick="downloadX(\'/abc?url=QjMxSlk2==PT13TjBjVE0yWURNMVF6TXhNek56VXpNd0FqTg__==QVJXWjJsbWJ1b1dZMGgyYg__\')"\r\n\t\t\t\thx-include="[name=tt]"\r\n\t\t\t\tclass="pure-button pure-button-primary is-center u-bl dl-button download_link without_watermark_hd vignette_active notranslate">Without watermark\t\t\t\tHD<i class="icon icon-ad-rewarded"></i></a>\r\n\t\t\t<input type="hidden" name="tt"\r\n\t\t\t\tvalue="QjMxSlk2">\r\n\t\t\t\r\n\t\t\t\t\t\t\t\t\t<a href="https://tikcdn.io/ssstik/aHR0cHM6Ly9zZjE2LnRpa3Rva2Nkbi11cy5jb20vb2JqL2llcy1tdXNpYy10eC83NDcxNjYwNzk4Nzg4NTY5ODk5Lm1wMw=="\r\n\t\t\t\tclass="pure-button pure-button-primary is-center u-bl dl-button download_link music vignette_active notranslate">Download\r\n\t\t\t\tMP3</a>\r\n\t\t\t\r\n\t\t\t\t\t\t<div id="trending-actions" class="trending-actions">\r\n\t\t\t\t<div class="d-flex flex-1 align-items-center justify-content-start">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"\r\n\t\t\t\t\t\t\tstroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\r\n\t\t\t\t\t\t\tclass="feather feather-thumbs-up">\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\td="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3">\r\n\t\t\t\t\t\t\t</path>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t10.6K\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="d-flex flex-1 align-items-center justify-content-center">\r\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"\r\n\t\t\t\t\t\tstroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\r\n\t\t\t\t\t\tclass="feather feather-message-square">\r\n\t\t\t\t\t\t<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t80\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="d-flex flex-1 align-items-center justify-content-end">\r\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"\r\n\t\t\t\t\t\tstroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\r\n\t\t\t\t\t\tclass="feather feather-share-2">\r\n\t\t\t\t\t\t<circle cx="18" cy="5" r="3"></circle>\r\n\t\t\t\t\t\t<circle cx="6" cy="12" r="3"></circle>\r\n\t\t\t\t\t\t<circle cx="18" cy="19" r="3"></circle>\r\n\t\t\t\t\t\t<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>\r\n\t\t\t\t\t\t<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t155\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t</div>\r\n</div>\r\n<style>\r\n\t#mainpicture .result_overlay {\r\n\t\tbackground-image: url(https://tikcdn.io/ssstik/p/aHR0cHM6Ly9wMTYtcHUtc2lnbi11c2Vhc3Q4LnRpa3Rva2Nkbi11cy5jb20vdG9zLXVzZWFzdDUtcC0wMDY4LXR4L293QURBZUhoa1RuUWZDMEFpRkRLM0lwNlNzVlJFdkZnQVJuRXV6fnRwbHYtdGlrdG9reC1jcm9wY2VudGVyLXE6MzAwOjQwMDpxNzIuaGVpYz9kcj04NTk2Jm5vbmNlPTYwNDY1JnJlZnJlc2hfdG9rZW49YjRiZjAwZGZlODQwZTBkZGM2ZTJhZmZlZWNiNTdlMWMmeC1leHBpcmVzPTE3Mzk4MDgwMDAmeC1zaWduYXR1cmU9WnhuRUpHWE1ONWxjNUNwUFV0dFRrdGNDZ3pnJTNEJmJpel90YWc9dHRfdmlkZW8maWRjPXVzZWFzdDUmcHM9OTMzYjViZGUmcz1BV0VNRV9ERVRBSUwmc2M9Y292ZXImc2hjcD0xZDFhOTdmYyZzaHA9ZDA1YjE0YmQmdD1iYWNkMDQ4MA==);\r\n\t}\r\n</style>\r\n<style>\r\n\t#report_issue {\r\n\t\tpadding: 0.8em;\r\n\t\tfont-size: 0.8em;\r\n\t\tbackground: #a498b1;\r\n\t\tmargin-top: 2em;\r\n\t\ttext-decoration: underline;\r\n\t}\r\n</style>\r\n<script>\r\n\tif (window.innerHeight > window.innerWidth) {\r\n\t\tdocument.getElementById(\'trending-actions\').style.display = \'none\';\r\n\t}\r\n</script>\r\n<script>\r\n\tif (iOS()) {\r\n\t\tdocument.getElementById(\'dl1\').appendChild(document.getElementById(\'direct_dl_link\'));\r\n\t\tconst ios_apps = {\r\n\t\t\tssstik: "https://apps.apple.com/app/apple-store/id1618823987?pt=124355880&ct=vidacha&mt=8",\r\n\t\t\ttikmaker: "https://apps.apple.com/app/apple-store/id6476889057?pt=126882543&ct=ssstik_comp&mt=8"\r\n\t\t};\r\n\t\tvar ios_app = ios_apps["ssstik"];\r\n\t\tif (rand >= 97 && rand <= 100) ios_app = ios_apps["tikmaker"];\r\n\t\tif (document.getElementById("direct_dl_link") !== null) {\r\n\t\t\tdocument.getElementById("direct_dl_link").style.display = "block";\r\n\t\t\tdocument.getElementById("direct_dl_link").href = ios_app;\r\n\t\t\tdocument.getElementById("direct_dl_link").innerHTML =\r\n\t\t\t\t\'<img src="/images/apple_logo_black.svg" width="20" height="20" style="vertical-align:bottom"> <b>Download with App</b>\';\r\n\t\t}\r\n\t\tif (document.getElementById("app_section_block") !== null) {\r\n\t\t\tdocument.getElementById("app_section_block").style.display = "none";\r\n\t\t}\r\n\t\tif (document.getElementById("twt_promo") !== null) {\r\n\t\t\tdocument.getElementById("twt_promo").style.display = "none";\r\n\t\t}\r\n\t\tif (document.getElementById("report_issue") !== null) {\r\n\t\t\tdocument.getElementById("report_issue").style.display = "block";\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isIOSGSA() {\r\n\t\tvar userPlatform = navigator?.userAgent?.toLowerCase() || "unknown";\r\n\t\treturn userPlatform.includes("gsa");\r\n\t}\r\n\tif (isIOSGSA()) {\r\n\t\tconst dlbuttons = document.getElementsByClassName("download_link");\r\n\t\tfor (let i = 0; i < dlbuttons.length; i++) {\r\n\t\t\tdlbuttons[i].setAttribute("target", "_blank");\r\n\t\t}\r\n\t}\r\n</script>\r\n<script>\r\n\tif (isAndroid()) {\r\n\t\tif (document.getElementById("direct_dl_link") !== null) {\r\n\t\t\tdocument.getElementById("direct_dl_link").style.display = "block";\r\n\t\t\tdocument.getElementById("direct_dl_link").href =\r\n\t\t\t\t"https://play.google.com/store/apps/details?id=" + android_app;\r\n\t\t\tdocument.getElementById("direct_dl_link").innerHTML =\r\n\t\t\t\t\'<img src="/images/android_logo_black.svg" width="20" height = "20" style="vertical-align:bottom"><b>Download with App</b>\';\r\n\t\t}\r\n\t\tif (document.getElementById("app_section_block") !== null) {\r\n\t\t\tdocument.getElementById("app_section_block").style.display = "none";\r\n\t\t}\r\n\t\tif (document.getElementById("twt_promo") !== null) {\r\n\t\t\tdocument.getElementById("twt_promo").style.display = "none";\r\n\t\t}\r\n\t}\r\n</script>\r\n'
```

while in a-shell i got something like this: 

```
b`\xd3\xc0\r\x00d\xbe\xd6\...etc
```

The fix is this: 

```python
# Before (original script)
with open('response.html', 'w', encoding='utf-8') as file:
    file.write(response.text)

# After (working script)
with open('response.html', 'wb') as f:
    file.write(response.content)
```

Here's what happened:

1. In the original script:
    - You opened the file in text mode ('w')
    - You used `response.text`, which attempts to decode the binary response to a string using UTF-8
    - When the content was actually compressed or contained binary data, this decoding step corrupted the data
2. In the working script:
    - You opened the file in binary mode (`wb`)
    - You used `response.content`, which preserves the raw binary data exactly as received
    - This preserved the content's integrity whether it was compressed or not

The "magic" is understanding the difference between:

- Binary data (`response.content`) - raw bytes that represent exactly what the server sent
- Text data (`response.text`) - an attempt to convert those bytes to a string using an encoding like UTF-8

When dealing with web responses, especially when they might contain compressed data or non-text content, it's safer to work with the binary data (`response.content`) and write it in binary mode (`wb`).

The additional check I added in the final script - looking at the first bytes to see if they appear to be HTML - just helps make the script more intelligent about when to attempt decompression versus when to just save the content directly.

What's likely happening is that `cloudscraper` is actually handling the decompression automatically (it can do this), but it's not updating the Content-Encoding header to reflect this. So when we were trying to decompress already-decompressed content, it failed - but saving the content directly worked because it was already in the correct format.